---
title: 'Generador de mapas de sitios de videos'
description: 'Este ejemplo demuestra cómo puede generar un mapa del sitio de video utilizando la API de CMS.'

parent: 'Code Samples' 
grandparent: CMS API
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Introduction">Introducción</h2>

    <aside class="bcls-aside bcls-aside--information">Esta muestra y el código asociado se proporcionan como una guía para su desarrollo de producción. El código no está certificado para uso en producción ni se admite oficialmente.</aside>

    <p>Antes de usar esta aplicación, debe leer <a href="https://studio.support.brightcove.com/general/making-your-video-content-indexable.html">Hacer que su contenido de video sea indexable</a> para comprender mejor el propósito de los mapas de sitios de video y las estrategias para automatizar la generación de los mismos utilizando la API de CMS. Generar el XML para el mapa del sitio es bastante sencillo. El mayor desafío es que debe incluir una URL única para cada video, y la <span translate="No">API de CMS</span> no tiene acceso automático a esta información. Para superar esto, hay un par de cosas que puede hacer:</p>

    <ol>
      <li>Agregue la URL donde se publica el video a los metadatos del video. La forma más sencilla de hacer esto sería crear un <a href="https://studio.support.brightcove.com/admin/creating-custom-metadata-fields.html">campo de metadatos personalizado</a> para almacenar la URL en.</li>
      <li>Aloje los videos en una sola página, usando un parámetro de URL para especificar el video <code translate="No">id</code> o <code translate="No">reference_id</code> que JavaScript personalizado en la página usará para cargar el video en el reproductor.
        <p>Hay varias formas de obtener el valor de un parámetro de URL específico para la página. A continuación se muestra una función que usamos en algunas de nuestras aplicaciones de muestra:</p>

        <pre class="line-numbers">
            <code class="language-javascript" translate="No">/**
             * gets value of a URL param on current page URL if exists
             * @param {string} name the param you want the value of
             * @return {string} result value of param if exists or null
             */
            function getURLparam(name) {
                var regex,
                    results;
                name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)");
                results = regex.exec(location.search);
                return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
            }</code></pre>

        <p>Una vez que tenga el <code translate="No">id</code> o <code translate="No">reference_id</code> , debe agregarlo al reproductor. Cómo lo haga dependerá de si está utilizando el estándar (<code translate="No">iframe</code> ) o código de inserción de reproductor avanzado (en la página). Probablemente lo más simple y seguro de hacer es&nbsp;a <a href="https://player.support.brightcove.com/code-samples/brightcove-player-sample-loading-player-dynamically.html">cargar el reproductor dinámicamente</a> (o no, si por alguna razón el parámetro de URL con el id no está presente).</p>

        <p>Un ejemplo de una sola página de HTML que se puede utilizar para este propósito es el documento en el <a href="#Single_page">Única página</a> sección siguiente.</p>
      </li>
    </ol>

    <p>La aplicación de muestra a continuación le permite usar cualquiera de los métodos; solo tiene que indicarle cuál ingresando la información en los campos correspondientes.</p>

    <h3>Notas sobre la aplicación de muestra:</h3>

    <ol>
      <li>La aplicación realiza una solicitud al <span translate="No">API de análisis</span> para obtener las vistas de video de todos los tiempos, por lo que si las credenciales de cliente que proporciona no incluyen permisos para la API de Analytics, la aplicación fallará.</li>
      <li>La cantidad máxima de videos que se pueden incluir es 50,000 y también hay un límite de 50 MB para el tamaño del archivo, que puede alcanzar con menos de 50,000 videos. Si tiene más videos que eso para incluir, tendrá que dividirlos en varios mapas del sitio y agregar un archivo de índice de mapa del sitio. Ver <a href="https://support.google.com/webmasters/answer/80471">Documentación del mapa del sitio de Google</a> para más información.</li>
      <li>El mapa del sitio generado por la aplicación de muestra no incluye algunas de las etiquetas opcionales para videos (consulte el documento de Google mencionado anteriormente para obtener información sobre ellos). Si desea incluirlos, puede tomar el código de esta aplicación y crear una versión modificada. Hay comentarios en el código JavaScript y HTML para indicar lo que debe hacer.
        <table class="bcls-table">
          <caption class="bcls-caption--table">Etiquetas opcionales incluidas o no</caption>
          <thead class="bcls-table__head">
            <tr>
              <th>Etiquetas incluidas</th>
              <th>Etiquetas no incluidas</th>
            </tr>
          </thead>
          <tbody class="bcls-table__body">
            <tr>
              <td>
                <ul>
                  <li>player_loc</li>
                  <li>duración</li>
                  <li>expiration_date (si corresponde)</li>
                  <li>conteo de visitas</li>
                  <li>fecha de publicación</li>
                  <li>familia_amigable</li>
                  <li>(geo) restricción (si corresponde)</li>
                </ul>
              </td>
              <td>
                <ul>
                  <li>content_loc</li>
                  <li>clasificación</li>
                  <li>plataforma</li>
                  <li>precio</li>
                  <li>requiere_suscripción</li>
                  <li>cargador</li>
                  <li>vivir</li>
                  <li>etiqueta</li>
                  <li>categoría</li>
                  <li>gallery_loc</li>
                </ul>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Los videos se omitirán si no cumplen con las condiciones necesarias, de la siguiente manera:
        <ul>
          <li>Si está almacenando la URL de la página del video en un campo personalizado, cualquier video que no tenga un valor para ese campo personalizado</li>
          <li>Si está utilizando una sola página para alojar sus vídeos y utiliza el <code translate="No">reference_id</code> para incluirlos, y el video carece de un <code translate="No">reference_id</code></li>
          <li>El video no tiene una imagen en miniatura.</li>
          <li>El video no tiene reproducción MP4</li>
          <li>El video está inactivo</li>
          <li>El video está programado para comenzar en una fecha futura</li>
          <li>El video estaba programado para finalizar antes de la fecha actual.</li>
        </ul>

        <p>Tenga en cuenta que para cualquier video que se omita, registro un mensaje en la consola del navegador que indica el motivo y la identificación del video.</p>
      </li>
    </ol>

    <p>Finalmente, si desea validar su mapa del sitio después de generarlo, existen varias herramientas gratuitas en la web para hacerlo, por ejemplo:</p>

    <p><a href="https://www.inspyder.com/free/SitemapValidator.aspx">Validador de sitemaps gratuito</a></p>
  </section>

  <section class="bcls-section">
    <details>
      <summary>
        <h2 id="getCredentials">Obtener credenciales</h2>
      </summary>

      <p>Usar el <span translate="No">API de CMS</span> necesitará las credenciales adecuadas.</p>

      <p>La forma más fácil de obtener credenciales en la mayoría de los casos es a través de la sección Autenticación de la API de administrador de Studio (requiere permisos de administrador en su cuenta). Ver <a href="/general/managing-api-authentication-credentials.html">Administrar las credenciales de autenticación de API</a> para detalles. En la mayoría de los casos, probablemente solo desee obtener permisos para todos <span translate="No">API de CMS</span> operación:</p>

      <figure class="bcls-figure"><img class="bcls-image" alt="CMS API Permissions" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/cms-api/cms-permissions.png" />
        <figcaption class="bcls-caption--image">Permisos de la API de CMS</figcaption>
      </figure>

      <p>Si los permisos que necesita no están disponibles en Studio, o si prefiere obtenerlos directamente de la API de OAuth, utilice su elección de <strong>Obtener credenciales de cliente</strong> documentos que se enumeran a continuación. Cualquiera que sea la opción que elija, deberá solicitar los permisos de operación correctos. Lo siguiente se puede usar con cURL, Postman o nuestra aplicación en línea para obtener todos los permisos para la API de CMS:</p>

      <pre class="line-numbers">
              <code class="language-json" translate="No">"operations": [
                "video-cloud/video/all",
                "video-cloud/playlist/all",
                "video-cloud/sharing-relationships/all",
                "video-cloud/notifications/all"
                "video-cloud/analytics/read"
              ]</code></pre>

      <ul>
        <li><a href="/oauth/guides/oauth-create-client-credentials-using-curl.html">OAuth: Obtener credenciales de cliente mediante cURL</a></li>
        <li><a href="/oauth/guides/oauth-create-client-credentials-using-postman.html">OAuth: Obtenga las credenciales del cliente con Postman</a></li>
        <li><a href="/oauth/code-samples/oauth-api-sample-create-client-credentials.html">Ejemplo de API de OAuth: Crear credenciales de cliente</a></li>
      </ul>
    </details>
  </section>

  <section class="bcls-section">
    <h2 id="sampleApp">Aplicación de muestra</h2>
    <h3>Código fuente</h3>
    <p>Encuentre todo el código asociado con esta muestra en este <a href="https://github.com/BrightcoveLearning/18739-cms-api-sample-video-sitemap-generator">Repositorio de GitHub</a>.</p>
    <h3>Aplicación de muestra</h3>
    <p class="codepen" data-height="1200" data-theme-id="34967" data-default-tab="result" data-user="rcrooks1969" data-slug-hash="VRLNJp" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="CMS API Sample: Video Sitemap Generator"><span>Ver la pluma <a href="https://codepen.io/team/rcrooks1969/pen/VRLNJp/"> <span translate="No">API de CMS</span> Muestra: Generador de mapas de sitios de video</a> por Brightcove Learning Services (<a href="https://codepen.io/rcrooks1969"> rcrooks1969</a> ) en <a href="https://codepen.io">CodePen</a>.</span></p>
    <script async="async" src="https://static.codepen.io/assets/embed/ei.js"></script>
  </section>

  <section class="bcls-section">
    <details>
      <summary>
        <h2 id="Using_the_CodePen">Usando el CodePen</h2>
      </summary>

      <p>A continuación, se incluyen algunos consejos para utilizar eficazmente el CodePen anterior:</p>

      <ul>
        <li>Cambie la visualización real del reproductor haciendo clic en el <strong>Resultado</strong> botón.</li>
        <li>Haga clic en el <strong>HTML / CSS / JS</strong> botones para mostrar UNO de los tipos de código.</li>
        <li>Hacer clic <strong>Editar en CodePen</strong> en la esquina superior derecha para bifurcar este CodePen en su propia cuenta.</li>
        <li>Encuentre todo el código asociado con esta muestra en este <a href="https://github.com/BrightcoveLearning/18739-cms-api-sample-video-sitemap-generator">Repositorio de GitHub</a>.</li>
      </ul>
    </details>
  </section>

  <section class="bcls-section">
    <h2 id="Single_page">Única página</h2>

    <p>Como se mencionó anteriormente, puede crear una página HTML que se puede utilizar para la ubicación de cada video. La aplicación modificará la URL de la página mediante un parámetro de consulta que define la identificación de video que debe usar la página. Por ejemplo, la aplicación generará JSON que contiene URL de ubicación similares a las siguientes para la ubicación de las páginas de video:</p>

    <pre class="line-numbers">
            <code class="language-json" translate="No">&lt;loc&gt;
                &lt;![CDATA[http://my.site.net/videos.html?videoId=5984663997001]]&gt;
            &lt;/loc&gt;
            ...
            &lt;loc&gt;
                &lt;![CDATA[http://my.site.net/videos.html?videoId=5982130568001]]&gt;
            &lt;/loc&gt;</code></pre>

    <p>Tenga en cuenta que solo cambia la identificación del video.</p>

    <p>La página HTML real lee el <strong>videoId</strong> Luego, el parámetro de URL genera dinámicamente un reproductor utilizando la identificación de video obtenida de la URL. La página HTML completa aparece de la siguiente manera:</p>

    <pre class="line-numbers">
            <code class="language-html" translate="No">&lt;!doctype html&gt;
            &lt;html&gt;
            
            &lt;head&gt;
              &lt;meta charset="UTF-8"&gt;
              &lt;title&gt;Load Player Dynamically from URL Param&lt;/title&gt;
              &lt;!-- Page styles --&gt;
              &lt;style&gt;
                .video-js {
                  width: 640px;
                  height: 360px;
                }
              &lt;/style&gt;
            &lt;/head&gt;
            
            &lt;body&gt;
              &lt;div id="placeHolder"&gt;&lt;/div&gt;
              &lt;!-- custom script --&gt;
              &lt;script type="text/JavaScript"&gt;
                var myPlayer,
                  playerHTML,
                  playerData = {},
                  theURLParam = '',
                  // Set the account ID to your account
                  myAccountId = '1507807800001';
            
                 // Read URL param for video ID
                theURLParam = geturlparam('videoId');
            
                // Assign data for the player instantiation
                playerData = {
                  'accountId': myAccountId,
                  'playerId': 'default',
                  'videoId': theURLParam
                };
            
                // Call function that builds player
                addPlayer();
            
                /**
                 * gets value of a url param on current page url if exists
                 * @param {string} name the param you want the value of
                 * @return {string} result value of param if exists or null
                 */
                function geturlparam(name) {
                  var regex,
                    results;
                  name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                  regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)");
                  results = regex.exec(location.search);
                  return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
                };
            
                // Dynamically adds player to page
                function addPlayer() {
                  // Dynamically build the player video element
                  playerHTML = '&lt;video-js id=\"myPlayerID\" data-video-id=\"' + playerData.videoId + '\"  data-account=\"' + playerData.accountId + '\" data-player=\"' + playerData.playerId + '\" data-embed=\"default\" class=\"video-js\" controls&gt;&lt;/video-js&gt;';
                  // Inject the player code into the DOM
                  document.getElementById('placeHolder').innerHTML = playerHTML;
                  // Add and execute the player script tag
                  var s = document.createElement('script');
                  s.src = "https://players.brightcove.net/" + playerData.accountId + "/" + playerData.playerId + "_default/index.min.js";
                  document.body.appendChild(s);
                  s.onload = callback;
                }
            
                 // Initialize the player and start the video
                function callback() {
                  myPlayer = bc('myPlayerID');
                  // Can also use the following to assign a player instance to the variable if you choose not to use IDs for elements directly
                  // myPlayer = bc(document.getElementById('myPlayerID'));
                  myPlayer.on('loadedmetadata', function () {
                    // Mute the audio track, if there is one, so video will autoplay on button click
                    myPlayer.muted(true);
                    myPlayer.play();
                  })
                }
              &lt;/script&gt;
            &lt;/body&gt;
            
            &lt;/html&gt;</code></pre>

    <p>Deberá ingresar su número de cuenta. Para obtener una explicación completa del código, consulte el <a href="https://player.support.brightcove.com/code-samples/brightcove-player-sample-loading-player-dynamically.html">Muestra de reproductor de Brightcove: Cargando el reproductor dinámicamente</a> documento.</p>
  </section>

    <section class="bcls-section">
    <details>
      <summary>
        <h2 id="proxy">Código de proxy</h2>
      </summary>

      <p>Para crear su propia versión de la aplicación de muestra en esta página, debe crear y alojar su propio proxy. (Los proxies utilizados por Brightcove Learning Services solo aceptan solicitudes de dominios de Brightcove). Un proxy de muestra, muy similar al que usamos, pero sin las comprobaciones que bloquean las solicitudes de dominios que no son de Brightcove, se puede encontrar en <a href="https://github.com/BrightcoveLearning/sample-proxy-apps">este repositorio de GitHub</a>. También encontrará instrucciones básicas para usarlo allí, y una guía más elaborada para crear aplicaciones alrededor del proxy en <a href="/getting-started/learning-guide-using-rest-apis.html">Usando las API REST</a>.</p>
    </details>
  </section>

</article>